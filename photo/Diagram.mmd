graph TD
    %% VSTUP
    User["ðŸŽ¤ UÅ¾ivatel (Hlas)"] -->|Audio Stream| AudioProc["ðŸ”Š VoiceSpeechProcessor"]
    
    %% 1. TRANSKRIPCE
    subgraph S1 [1. TRANSKRIPCE - STT]
        AudioProc --> CheckProvider1{"AI PROVIDER"}
        
        %% Cesta A: Cloud
        CheckProvider1 -->|groq| CloudSTT["â˜ï¸ Groq API (Whisper Turbo)"]
        
        %% Cesta B: Local
        CheckProvider1 -->|local| LocalSTT["ðŸ’» LokÃ¡lnÃ­ VOSK (Small-CS)"]
        
        CloudSTT --> Text["ðŸ“„ TextovÃ½ pÅ™epis"]
        LocalSTT --> Text
    end

    %% 2. LLM / AI MODELY
    subgraph S2 [2. EXTRAKCE DAT - LLM Router]
        Text --> CheckProvider2{"AI PROVIDER"}
        
        %% Cesta A: Cloud (NynÃ­ rozdÄ›lenÃ¡)
        CheckProvider2 -->|cloud| CloudSelect{"SluÅ¾ba?"}
        CloudSelect -->|Groq| GroqLLM["â˜ï¸ Groq (Llama 3)"]
        CloudSelect -->|Google| GoogleLLM["â˜ï¸ Google AI (Gemini)"]
        
        %% Cesta B: Local
        CheckProvider2 -->|local| LocalLLM["ðŸ’» LokÃ¡lnÃ­ OLLAMA (Gemma/DeepSeek)"]
        
        GroqLLM --> JSON["ðŸ“¦ ExtrahovanÃ½ JSON"]
        GoogleLLM --> JSON
        LocalLLM --> JSON
    end

    %% 3. POST-PROCESSING
    subgraph S3 [3. LOGIKA a KATEGORIZACE]
        JSON --> Synonyms["ðŸ”„ Normalizace Synonym"]
        Synonyms --> Categorizer["ðŸ“‚ KATEGORIZACE DAT"]
        
        %% VÄ›tvenÃ­ po kategorizaci
        Categorizer -->|TÅ™Ã­dÄ›nÃ­ do tabulek| DataFrames["ðŸ¼ Tabulky: DrABCDE, LÃ©ky, JinÃ©..."]
        Categorizer -->|Extrakce hodnot| DictVitals["â¤ï¸ Vitals: TF, TK, SpO2..."]
    end

    %% 4. ULOÅ½IÅ TÄš
    subgraph S4 [4. STORAGE a LOGS]
        DataFrames --> CSV["ðŸ’¾ CSV Soubory (/sessions)"]
        AudioProc -.->|VolitelnÄ›| WavFile["ðŸŽµ WAV/MP3 ZÃ¡znam"]
    end

    %% 5. VÃSTUP
    subgraph S5 [5. REAL-TIME DASHBOARD]
        DictVitals -->|SocketIO Emit| Web["ðŸŒ Web Dashboard"]
        DataFrames -->|SocketIO Emit| Web
    end